<!DOCTYPE html>
<html>
<head>
    <title>AA_stat report</title>
    <style type="text/css">
        #fixmod {
          margin-left: auto;
          margin-right: auto;
          margin-top: 1vh;
          margin-bottom: 1vh;
          text-align: center;
        }
        #aa_stat {
          text-align: center;
        }
        #pic_container {
          max-height: 80vh;
          max-width: 85vw;
          min-height: 25vh;
          display: block;
          margin-left: auto;
          margin-right: auto;
          overflow-x: auto;
        }
        #pic {
          max-height: 80vh;
          display: block;
          margin-left: auto;
          margin-right: auto;
        }
        .figure {
          max-width: 70vw;
        }
        #legend {
          display: none;
          overflow: auto;
          margin: 0 auto;
          width: 81vw;
        }
        table {
          border: 1px solid black;
          text-align: center;
          margin-left: auto;
          margin-right: auto;
        }
        .legend.peptides {
          color: #FF6600;
        }
        .legend.freq {
          color: #88AA00;
        }
        .legend.localized {
          color: #006688;
        }
        .loc {
          color: #FF0000;
        }
        #legend p {
          max-width: 25vw;
          margin-left: 1vw;
          margin-right: 1vw;
          float: left;
          text-align: justify;
        }
        #legend h2, #peptides h2 {
          text-align: center;
        }
        .peptide_table {
          display: none;
          text-align: center;
          width: fit-content;
        }
    </style>
</head>
<body>
<div id="fixmod">
  <h3>Fixed modifications</h3>
  ===
</div>
<div id="aa_stat">
  <h3>Amino acid statistics</h3>
  %%%
</div>
<div id="legend">
  <h2>Figure Legend</h2>
  <p>
    <span class="legend freq">Relative AA abundance</span>: this value represents the difference in occurrence frequency
    between peptides with the given mass shift and the peptides with unshifted masses.
    The AA occurrence frequency is calculated for all mass shifts as follows: the AA is counted in all peptides without miscleavages,
    then the AA count is divided by the total of all AA counts.
    Each AA occurrence frequency for each shift is then divided by the occurrence frequency of the same AA at zero mass shift.
    Thus, values below 1 mean that the AA is "depleted" and values above 1 mean that it is "enriched" at a certain mass shift.
  </p>
  <p>
    <span class="legend peptides">Peptides with AA, %</span>: This is the percentage of peptides at the given mass shift that contain
    at least one AA residue of a certain kind. This is useful to assess the meaning of the observed frequencies.
  </p>
  <p>
    <span class="legend localized">Localization count</span>: if spectrum files are provided to AA_stat, each MS/MS spectrum of shifted peptides
    is tested for localization of mass shifts. This axis counts successful localizations of mass shifts at each AA. The counts are not normalized.
  </p>
</div>
<div id="pic_container">
  <img id="pic" src="summary.png">
</div>

<div id="peptides">
  <h2 id="table_header"></h2>
  &&&
</div>
</body>
<script type="text/javascript">
  function getMassShift(elem) {
    eid = elem.parentElement.id;
    return document.getElementById(eid.replace("col1", "col0")).children[0].text;
  };
  function hideTablesAndLegend() {
    var tables = document.getElementsByClassName('peptide_table');
    for(j = 0; j < tables.length; j++) {
        tables[j].style.display = 'none';
      };
    document.getElementById('legend').style.display = 'none';
    // document.getElementById('table_header').textContent = "";
  };
  function showPic(src) {
    hideTablesAndLegend();
    var pic = document.getElementById('pic');
    pic.src = src;
    pic.style.display = 'block';
    if (src == 'summary.png') {
      pic.classList.add('summary');
      pic.classList.remove('figure');
    }
    else {
      pic.classList.remove('summary');
      pic.classList.add('figure');
    };

  };
  function showTable(elem) {
    hideTablesAndLegend();
    var ms = getMassShift(elem);
    showPic(ms + '.png');
    document.getElementById('peptides_'+ms).style.display = 'block';
    // document.getElementById('table_header').textContent = "Mass shift " + ms + " (" + elem.text + " peptides)";
  }

  var shifts = document.getElementsByClassName('data col0');
  for(i = 0; i < shifts.length; i++) {
    shifts[i].children[0].onclick = function (e) {
      showPic(e.target.text + '.png');
      document.getElementById('legend').style.display = 'block';
    }
  }

  var binh = document.getElementById('binh');
  binh.onclick = function (e) {
    showPic('summary.png');
    hideTablesAndLegend();
  };

  var amounts = document.getElementsByClassName('data col1');
  for(i = 0; i < amounts.length; i++) {
    amounts[i].children[0].onclick = function (e) {
      document.getElementById('pic').style.display = 'none';

      showTable(e.target);
    }
  }
</script>
</html>
